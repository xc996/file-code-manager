# 🧪 本地测试完整指南

## 方法一：使用 Wrangler（完整功能测试）

### 1️⃣ 安装 Node.js
如果还没安装，访问 https://nodejs.org/ 下载安装最新 LTS 版本

### 2️⃣ 安装项目依赖
```bash
# 在项目目录下运行
npm install
```

### 3️⃣ 创建本地 KV 命名空间
```bash
# 登录 Cloudflare
npx wrangler login

# 创建预览用的 KV
npx wrangler kv:namespace create FILE_CODES_KV --preview
```

命令会输出类似：
```
✨ Success!
{ binding = "FILE_CODES_KV", preview_id = "xxxxxxxx" }
```

### 4️⃣ 更新 wrangler.toml
将上一步获得的 `preview_id` 添加到 wrangler.toml：

```toml
[[kv_namespaces]]
binding = "FILE_CODES_KV"
id = "your-production-id-here"  # 生产环境 ID（暂时可以用任意值）
preview_id = "xxxxxxxx"  # 替换为刚才获得的 preview_id
```

### 5️⃣ 启动本地开发服务器
```bash
npx wrangler pages dev ./ --kv FILE_CODES_KV
```

或使用 npm 脚本：
```bash
npm run dev
```

### 6️⃣ 访问测试
打开浏览器访问：http://localhost:8788

**默认密码：** `admin123`

### 7️⃣ 测试功能
- ✅ 登录功能
- ✅ 文本解析
- ✅ 添加/编辑/删除文件码
- ✅ 搜索功能
- ✅ 批量操作
- ✅ 数据导出
- ✅ 刷新页面数据是否保存

---

## 方法二：简易 HTTP 服务器（仅测试前端）

如果只想快速查看界面（不测试 KV 存储）：

### 使用 Python
```bash
# Python 3
python -m http.server 8000

# 访问 http://localhost:8000
```

### 使用 Node.js
```bash
# 安装 http-server
npm install -g http-server

# 启动服务器
http-server -p 8000

# 访问 http://localhost:8000
```

### 使用 VS Code
安装 "Live Server" 扩展，右键 index.html → "Open with Live Server"

**注意：** 这种方式 API 功能无法使用，数据无法保存！

---

## 🐛 常见问题

### Q: Wrangler 命令找不到
```bash
# 全局安装 Wrangler
npm install -g wrangler

# 或使用 npx（推荐）
npx wrangler --version
```

### Q: KV 绑定错误
确保：
1. 已运行 `wrangler kv:namespace create --preview`
2. wrangler.toml 中 `preview_id` 已更新
3. 绑定名称是 `FILE_CODES_KV`

### Q: 登录失败
检查 `.dev.vars` 文件是否存在且包含 PASSWORD_HASH

### Q: 端口被占用
```bash
# 指定其他端口
npx wrangler pages dev ./ --port 8080
```

---

## 📝 开发小技巧

### 自动重载
Wrangler 开发服务器支持热重载：
- 修改 index.html → 自动刷新
- 修改 functions/api/[[route]].js → 自动重启

### 查看日志
Wrangler 会在终端显示：
- HTTP 请求日志
- Console.log 输出
- 错误信息

### 调试技巧
1. 打开浏览器开发者工具（F12）
2. 查看 Network 标签页的 API 请求
3. 查看 Console 标签页的错误信息
4. 在代码中添加 console.log() 调试

---

## ✅ 测试检查清单

本地测试时请验证：

- [ ] 登录功能正常
- [ ] 文本解析识别文件码
- [ ] 手动添加文件码
- [ ] 编辑备注保存成功
- [ ] 复制文件码到剪贴板
- [ ] 删除文件码（含确认弹窗）
- [ ] 搜索过滤功能
- [ ] 批量选择和删除
- [ ] 数据导出为 JSON
- [ ] 刷新页面数据持久化
- [ ] 退出登录功能
- [ ] 手机端响应式布局

---

## 🚀 测试通过后

本地测试没问题，就可以部署到 Cloudflare Pages 了！

下一步：查看 `QUICKSTART.md` 或 `DEPLOYMENT.md` 进行部署

