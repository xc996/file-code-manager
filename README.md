# ğŸ“ æ–‡ä»¶ç ç®¡ç†ç³»ç»Ÿ

ä¸€ä¸ªéƒ¨ç½²åœ¨ Cloudflare Pages çš„ç°ä»£åŒ–æ–‡ä»¶ç ç®¡ç†å·¥å…·ï¼Œæ”¯æŒæ–‡æœ¬è§£æã€åˆ—è¡¨ç®¡ç†ã€æ•°æ®æŒä¹…åŒ–å’Œè®¿é—®æ§åˆ¶ã€‚

## âœ¨ åŠŸèƒ½ç‰¹ç‚¹

### æ ¸å¿ƒåŠŸèƒ½
- ğŸ” **æ™ºèƒ½è§£æ**ï¼šè‡ªåŠ¨è¯†åˆ«å¹¶æå–æ–‡ä»¶ç ï¼ˆæ”¯æŒ `@filepan_bot:xxx` å’Œ `showfilesbot_xxx` æ ¼å¼ï¼‰
- ğŸ“ **åˆ—è¡¨ç®¡ç†**ï¼šç¼–è¾‘å¤‡æ³¨ã€ä¸€é”®å¤åˆ¶ã€åˆ é™¤è®°å½•
- ğŸ’¾ **æ•°æ®æŒä¹…åŒ–**ï¼šä½¿ç”¨ Cloudflare Workers KV å­˜å‚¨æ•°æ®
- ğŸ” **è®¿é—®æ§åˆ¶**ï¼šå¯†ç ä¿æŠ¤ï¼ŒSHA-256 åŠ å¯†éªŒè¯
- ğŸ¨ **ç°ä»£ UI**ï¼šæ·±è‰²ä¸»é¢˜ï¼Œå“åº”å¼è®¾è®¡ï¼Œä¼˜é›…çš„ç”¨æˆ·ä½“éªŒ

### é«˜çº§åŠŸèƒ½
- ğŸ” **æœç´¢è¿‡æ»¤**ï¼šæŒ‰æ–‡ä»¶ç æˆ–æ ‡ç­¾å¿«é€Ÿæœç´¢
- âœ… **æ‰¹é‡æ“ä½œ**ï¼šæ‰¹é‡é€‰æ‹©ã€æ‰¹é‡åˆ é™¤
- ğŸ“¤ **æ•°æ®å¯¼å‡º**ï¼šJSON æ ¼å¼å¯¼å‡ºæ‰€æœ‰æ•°æ®
- ğŸ“Š **ç»Ÿè®¡ä¿¡æ¯**ï¼šå®æ—¶æ˜¾ç¤ºæ–‡ä»¶ç æ•°é‡
- âš¡ **æ€§èƒ½ä¼˜åŒ–**ï¼šRate limitingã€ä¼šè¯ç®¡ç†

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

### å‰ç½®è¦æ±‚
- [Cloudflare è´¦å·](https://dash.cloudflare.com/sign-up)
- [Node.js](https://nodejs.org/) å’Œ npmï¼ˆç”¨äºæœ¬åœ°å¼€å‘ï¼‰
- [Wrangler CLI](https://developers.cloudflare.com/workers/wrangler/install-and-update/)ï¼ˆå¯é€‰ï¼‰

### éƒ¨ç½²æ­¥éª¤

#### æ–¹æ³• 1ï¼šé€šè¿‡ Cloudflare Dashboardï¼ˆæ¨èï¼‰

1. **åˆ›å»º KV å‘½åç©ºé—´**
   - ç™»å½• [Cloudflare Dashboard](https://dash.cloudflare.com/)
   - è¿›å…¥ Workers & Pages â†’ KV
   - ç‚¹å‡» "Create a namespace"
   - å‘½åä¸º `FILE_CODES_KV`
   - è®°ä¸‹åˆ›å»ºçš„ namespace ID

2. **åˆ›å»º Pages é¡¹ç›®**
   - è¿›å…¥ Workers & Pages â†’ Create application â†’ Pages â†’ Connect to Git
   - é€‰æ‹©ä½ çš„ Git ä»“åº“ï¼ˆGitHub/GitLabï¼‰
   - æˆ–è€…é€‰æ‹© "Direct Upload" ç›´æ¥ä¸Šä¼ æ–‡ä»¶

3. **é…ç½® Pages é¡¹ç›®**
   
   **ç»‘å®š KV å‘½åç©ºé—´ï¼š**
   - è¿›å…¥ Pages é¡¹ç›® â†’ Settings â†’ Functions
   - æ‰¾åˆ° "KV namespace bindings"
   - æ·»åŠ ç»‘å®šï¼š
     - Variable name: `FILE_CODES_KV`
     - KV namespace: é€‰æ‹©åˆšåˆ›å»ºçš„å‘½åç©ºé—´

   **è®¾ç½®ç¯å¢ƒå˜é‡ï¼š**
   - è¿›å…¥ Pages é¡¹ç›® â†’ Settings â†’ Environment variables
   - æ·»åŠ å˜é‡ï¼š
     - Variable name: `PASSWORD_HASH`
     - Value: ä½ çš„å¯†ç çš„ SHA-256 å“ˆå¸Œå€¼
   - åº”ç”¨åˆ° Production å’Œ Preview ç¯å¢ƒ

4. **éƒ¨ç½²**
   - å¦‚æœæ˜¯ Git è¿æ¥ï¼šæ¨é€ä»£ç åˆ°ä»“åº“å³è‡ªåŠ¨éƒ¨ç½²
   - å¦‚æœæ˜¯ Direct Uploadï¼šä¸Šä¼ é¡¹ç›®æ–‡ä»¶å¤¹

#### æ–¹æ³• 2ï¼šä½¿ç”¨ Wrangler CLI

```bash
# 1. å®‰è£… Wrangler
npm install -g wrangler

# 2. ç™»å½• Cloudflare
wrangler login

# 3. åˆ›å»º KV å‘½åç©ºé—´
wrangler kv:namespace create FILE_CODES_KV

# è®°ä¸‹è¿”å›çš„ IDï¼Œæ›´æ–° wrangler.toml ä¸­çš„ id å­—æ®µ

# 4. éƒ¨ç½²åˆ° Pages
wrangler pages deploy ./ --project-name=file-code-manager

# 5. é…ç½®ç¯å¢ƒå˜é‡ï¼ˆé€šè¿‡ Dashboardï¼‰
# è¿›å…¥ Pages é¡¹ç›®è®¾ç½®æ·»åŠ  PASSWORD_HASH
```

### ç”Ÿæˆå¯†ç å“ˆå¸Œ

ä½ éœ€è¦ç”Ÿæˆå¯†ç çš„ SHA-256 å“ˆå¸Œå€¼ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š

**åœ¨çº¿å·¥å…·ï¼š**
è®¿é—® https://emn178.github.io/online-tools/sha256.html è¾“å…¥å¯†ç è·å–å“ˆå¸Œå€¼

**ä½¿ç”¨ Node.jsï¼š**
```javascript
const crypto = require('crypto');
const password = 'your-password-here';
const hash = crypto.createHash('sha256').update(password).digest('hex');
console.log(hash);
```

**ä½¿ç”¨ Pythonï¼š**
```python
import hashlib
password = 'your-password-here'
hash_value = hashlib.sha256(password.encode()).hexdigest()
print(hash_value)
```

**é»˜è®¤å¯†ç ï¼š**
- å¯†ç ï¼š`admin123`
- å“ˆå¸Œï¼š`240be518fabd2724ddb6f04eeb1da5967448d7e831c08c8fa822809f74c720a9`

âš ï¸ **å®‰å…¨æç¤º**ï¼šéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒå‰ï¼Œè¯·åŠ¡å¿…ä¿®æ”¹é»˜è®¤å¯†ç ï¼

## ğŸ“ é¡¹ç›®ç»“æ„

```
file-code-manager/
â”œâ”€â”€ index.html              # å‰ç«¯å•é¡µåº”ç”¨
â”œâ”€â”€ functions/              # Cloudflare Functions
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ [[route]].js   # API è·¯ç”±å¤„ç†
â”œâ”€â”€ wrangler.toml          # Cloudflare é…ç½®
â”œâ”€â”€ .gitignore             # Git å¿½ç•¥æ–‡ä»¶
â””â”€â”€ README.md              # é¡¹ç›®æ–‡æ¡£
```

## ğŸ”§ é…ç½®è¯´æ˜

### wrangler.toml

```toml
name = "file-code-manager"
compatibility_date = "2024-01-01"
pages_build_output_dir = "./"

[[kv_namespaces]]
binding = "FILE_CODES_KV"
id = "your-kv-namespace-id-here"  # æ›¿æ¢ä¸ºä½ çš„ KV ID
```

### ç¯å¢ƒå˜é‡

| å˜é‡å | è¯´æ˜ | å¿…éœ€ |
|--------|------|------|
| `PASSWORD_HASH` | ç™»å½•å¯†ç çš„ SHA-256 å“ˆå¸Œ | æ˜¯ |

### KV ç»‘å®š

| ç»‘å®šåç§° | ç”¨é€” | KV Key |
|----------|------|---------|
| `FILE_CODES_KV` | å­˜å‚¨æ–‡ä»¶ç æ•°æ® | `FILE_CODES_LIST` |

## ğŸ“– ä½¿ç”¨æŒ‡å—

### ç™»å½•
1. è®¿é—®éƒ¨ç½²åçš„ç½‘ç«™
2. è¾“å…¥å¯†ç ç™»å½•ï¼ˆé»˜è®¤ï¼šadmin123ï¼‰
3. ç™»å½•çŠ¶æ€ä¿æŒåœ¨æµè§ˆå™¨ä¼šè¯ä¸­

### è§£ææ–‡æœ¬
1. åœ¨"ç²˜è´´æ–‡æœ¬è¿›è¡Œè§£æ"åŒºåŸŸè¾“å…¥åŒ…å«æ–‡ä»¶ç çš„æ–‡æœ¬
2. ç‚¹å‡»"è§£æå¹¶æ·»åŠ "
3. ç³»ç»Ÿè‡ªåŠ¨è¯†åˆ«å¹¶æå–æ‰€æœ‰æ–‡ä»¶ç 

### ç®¡ç†æ–‡ä»¶ç 
- **ç¼–è¾‘å¤‡æ³¨**ï¼šç‚¹å‡»"ç¼–è¾‘"æŒ‰é’®ä¿®æ”¹å¤‡æ³¨ä¿¡æ¯
- **å¤åˆ¶æ–‡ä»¶ç **ï¼šç‚¹å‡»"å¤åˆ¶"æŒ‰é’®å¤åˆ¶åˆ°å‰ªè´´æ¿
- **åˆ é™¤è®°å½•**ï¼šç‚¹å‡»"åˆ é™¤"æŒ‰é’®ï¼ˆéœ€äºŒæ¬¡ç¡®è®¤ï¼‰
- **æ‰‹åŠ¨æ·»åŠ **ï¼šä½¿ç”¨"æ‰‹åŠ¨æ·»åŠ æ–‡ä»¶ç "è¡¨å•

### æœç´¢å’Œæ‰¹é‡æ“ä½œ
- **æœç´¢**ï¼šåœ¨æœç´¢æ¡†è¾“å…¥å…³é”®è¯è¿‡æ»¤åˆ—è¡¨
- **æ‰¹é‡é€‰æ‹©**ï¼šç‚¹å‡»"æ‰¹é‡é€‰æ‹©"è¿›å…¥æ‰¹é‡æ¨¡å¼
- **æ‰¹é‡åˆ é™¤**ï¼šé€‰æ‹©å¤šä¸ªé¡¹ç›®åç‚¹å‡»"æ‰¹é‡åˆ é™¤"
- **å¯¼å‡ºæ•°æ®**ï¼šç‚¹å‡»é¡¶éƒ¨"å¯¼å‡ºæ•°æ®"æŒ‰é’®ä¸‹è½½ JSON æ–‡ä»¶

## ğŸ”’ å®‰å…¨ç‰¹æ€§

- âœ… SHA-256 å¯†ç åŠ å¯†
- âœ… Session ä¼šè¯ç®¡ç†ï¼ˆ24å°æ—¶è¿‡æœŸï¼‰
- âœ… Rate Limitingï¼ˆé˜²æ­¢æš´åŠ›ç ´è§£ï¼‰
- âœ… XSS é˜²æŠ¤ï¼ˆè¾“å…¥è½¬ä¹‰ï¼‰
- âœ… CORS é…ç½®
- âœ… 401 è‡ªåŠ¨é€€å‡ºç™»å½•

## ğŸ¨ UI ç‰¹æ€§

- ğŸŒ™ æ·±è‰²ä¸»é¢˜è®¾è®¡
- ğŸ“± å®Œå…¨å“åº”å¼å¸ƒå±€
- âœ¨ æµç•…çš„åŠ¨ç”»æ•ˆæœ
- ğŸ¯ ç›´è§‚çš„æ“ä½œåé¦ˆ
- ğŸ“Š å®æ—¶ç»Ÿè®¡ä¿¡æ¯
- ğŸ”” å‹å¥½çš„é€šçŸ¥æç¤º

## ğŸ› ï¸ æœ¬åœ°å¼€å‘

```bash
# 1. å…‹éš†é¡¹ç›®
git clone <your-repo-url>
cd file-code-manager

# 2. å®‰è£… Wranglerï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
npm install -g wrangler

# 3. åˆ›å»ºå¼€å‘ç¯å¢ƒ KV
wrangler kv:namespace create FILE_CODES_KV --preview

# 4. æ›´æ–° wrangler.toml ä¸­çš„å¼€å‘ç¯å¢ƒé…ç½®

# 5. å¯åŠ¨æœ¬åœ°å¼€å‘æœåŠ¡å™¨
wrangler pages dev ./ --kv FILE_CODES_KV=<your-dev-kv-id>
```

è®¿é—® http://localhost:8788 æŸ¥çœ‹åº”ç”¨ã€‚

## ğŸ“Š API æ¥å£

### POST /api/auth
ç™»å½•éªŒè¯

**è¯·æ±‚ï¼š**
```json
{
  "password": "sha256_hash_here"
}
```

**å“åº”ï¼š**
```json
{
  "success": true,
  "session": "session_id_here"
}
```

### GET /api/data
è·å–æ‰€æœ‰æ–‡ä»¶ç æ•°æ®

**Headersï¼š**
```
X-Session: your_session_id
```

**å“åº”ï¼š**
```json
{
  "data": [
    {
      "id": 1234567890,
      "code": "@filepan_bot:abc123",
      "note": "å¤‡æ³¨ä¿¡æ¯",
      "createdAt": "2024-01-01T00:00:00.000Z"
    }
  ]
}
```

### POST /api/data
ä¿å­˜æ–‡ä»¶ç æ•°æ®

**Headersï¼š**
```
X-Session: your_session_id
Content-Type: application/json
```

**è¯·æ±‚ï¼š**
```json
{
  "data": [...]
}
```

**å“åº”ï¼š**
```json
{
  "success": true
}
```

## ğŸ› æ•…éšœæ’é™¤

### KV å‘½åç©ºé—´æœªç»‘å®š
**é”™è¯¯ï¼š** "KV namespace not bound"

**è§£å†³ï¼š** 
1. ç¡®è®¤å·²åˆ›å»º KV å‘½åç©ºé—´
2. åœ¨ Pages é¡¹ç›®è®¾ç½®ä¸­æ­£ç¡®ç»‘å®š
3. é‡æ–°éƒ¨ç½²é¡¹ç›®

### å¯†ç éªŒè¯å¤±è´¥
**é”™è¯¯ï¼š** å¯†ç é”™è¯¯

**è§£å†³ï¼š**
1. ç¡®è®¤ PASSWORD_HASH ç¯å¢ƒå˜é‡å·²è®¾ç½®
2. éªŒè¯å“ˆå¸Œå€¼æ˜¯å¦æ­£ç¡®
3. æ£€æŸ¥æ˜¯å¦åº”ç”¨åˆ°æ­£ç¡®çš„ç¯å¢ƒï¼ˆProduction/Previewï¼‰

### 401 æœªæˆæƒ
**é”™è¯¯ï¼š** é¢‘ç¹è·³è½¬åˆ°ç™»å½•é¡µ

**è§£å†³ï¼š**
1. æ£€æŸ¥æµè§ˆå™¨ sessionStorage æ˜¯å¦è¢«æ¸…é™¤
2. ç¡®è®¤ session æœªè¿‡æœŸï¼ˆ24å°æ—¶ï¼‰
3. æ£€æŸ¥ç½‘ç»œè¯·æ±‚ä¸­æ˜¯å¦åŒ…å« X-Session header

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0 (2024-01-01)
- âœ¨ åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- ğŸ” å®ç°å¯†ç ä¿æŠ¤å’Œä¼šè¯ç®¡ç†
- ğŸ’¾ é›†æˆ Cloudflare KV å­˜å‚¨
- ğŸ¨ ç°ä»£åŒ– UI è®¾è®¡
- ğŸ” æœç´¢å’Œæ‰¹é‡æ“ä½œåŠŸèƒ½
- ğŸ“¤ æ•°æ®å¯¼å‡ºåŠŸèƒ½

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ“® è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ GitHub Issues è”ç³»ã€‚

---

**äº«å—ä½¿ç”¨ï¼** ğŸ‰

